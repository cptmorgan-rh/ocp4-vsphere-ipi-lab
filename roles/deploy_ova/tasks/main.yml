  - name: Download the ova file
    get_url:
      url: "{{ download.ova }}"
      dest: "{{ playbook_dir }}/downloads/{{ infraID.stdout }}-rhcos.ova"
      validate_certs: no

  - name: Deploy the OVA template into the folder
    command: "govc import.ova --name={{ infraID.stdout }}-rhcos --ds={{ vcenter.datastore }} --options={{ playbook_dir }}/roles/deploy_ova/files/options.json --folder={{ vcenter.folder_absolute_path }} {{ playbook_dir }}/downloads/{{ infraID.stdout }}-rhcos.ova"

  - name: Update VM options on "{{ vcenter.template_name }}"
    command: "govc vm.change -vm {{ vcenter.folder_absolute_path }}/{{ infraID.stdout }}-rhcos -e=disk.EnableUUID=TRUE" # noqa 204

  - name: Mark "{{ vcenter.template_name }}" as a template
    command: "govc vm.markastemplate {{ vcenter.folder_absolute_path }}/{{ infraID.stdout }}-rhcos"
